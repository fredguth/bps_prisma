generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views", "driverAdapters"]
}

generator docs {
  provider = "node node_modules/prisma-docs-generator"
  output   = "../docs"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Compra {
  id               Int      @id @unique @default(autoincrement())
  data             DateTime
  modalidade       String
  judicial         Int      @default(dbgenerated("true"))
  instituicao      String
  cnpj_instituicao String
  uf               String
  Item             Item[]
}

model Produto {
  id              Int      @id @unique @default(autoincrement())
  cnpj_fabricante String
  nome            String
  susbstancia     String
  embalagem       String
  codigobr        String
  unidade         String
  qtd_embalagem   Int
  registro_anvisa String
  material_id     Int
  Item            Item[]
  material        Material @relation(fields: [material_id], references: [id], onDelete: Cascade)
  fabricante      PJ       @relation(fields: [cnpj_fabricante], references: [cnpj], onDelete: Cascade)
}

model Item {
  id              Int      @id @default(autoincrement())
  compra_id       Int
  codigobr        String
  unidade         String
  anvisa          String?
  cnpj_fornecedor String
  cnpj_fabricante String
  qtd_item        Int
  valor_item      Float
  material_id     Int
  produto_id      Int
  produto         Produto  @relation(fields: [produto_id], references: [id], onDelete: Cascade)
  material        Material @relation(fields: [material_id], references: [id], onDelete: Cascade)
  fabricante      PJ       @relation("Fabricante", fields: [cnpj_fabricante], references: [cnpj], onDelete: Cascade)
  fornecedor      PJ       @relation("Fornecedor", fields: [cnpj_fornecedor], references: [cnpj], onDelete: Cascade)
  compra          Compra   @relation(fields: [compra_id], references: [id], onDelete: Cascade)
}

model PJ {
  cnpj            String    @id
  razao_social    String
  ibge            String
  municipio       String
  uf              String
  fabricanteItems Item[]    @relation("Fabricante")
  fornecedorItems Item[]    @relation("Fornecedor")
  Produto         Produto[]
}

model Material {
  id         Int       @id @unique @default(autoincrement())
  codigobr   String
  unidade    String
  classe     String
  pdm        String
  descricao  String
  disponivel Int       @default(dbgenerated("true"))
  Item       Item[]
  Produto    Produto[]
}

model User {
  id          String    @id @unique
  cpf         String    @unique
  email       String?   @unique
  name        String?
  phone       String?
  key         Key[]
  auth_ession Session[]
}

model Session {
  id             String @id @unique
  user_id        String
  active_expires BigInt
  idle_expires   BigInt
  user           User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

model Key {
  id              String  @id @unique
  hashed_password String?
  user_id         String
  user            User    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

view ItensCompra {
  item_id         Int      @unique
  compra_id       Int
  data            DateTime
  material_id     Int
  produto_id      Int
  anvisa          String?
  produto         String?
  cnpj_fornecedor String?
  cnpj_fabricante String?
  fabricante      String?
  fornecedor      String?
  qtde            Int
  valor_unitario  Float
}
